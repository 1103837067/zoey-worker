<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoey Worker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            background: 'hsl(0 0% 100%)',
            foreground: 'hsl(222.2 84% 4.9%)',
            card: 'hsl(0 0% 100%)',
            'card-foreground': 'hsl(222.2 84% 4.9%)',
            primary: {
              DEFAULT: 'hsl(222.2 47.4% 11.2%)',
              foreground: 'hsl(210 40% 98%)',
            },
            secondary: {
              DEFAULT: 'hsl(210 40% 96.1%)',
              foreground: 'hsl(222.2 47.4% 11.2%)',
            },
            muted: {
              DEFAULT: 'hsl(210 40% 96.1%)',
              foreground: 'hsl(215.4 16.3% 46.9%)',
            },
            accent: {
              DEFAULT: 'hsl(210 40% 96.1%)',
              foreground: 'hsl(222.2 47.4% 11.2%)',
            },
            destructive: {
              DEFAULT: 'hsl(0 84.2% 60.2%)',
              foreground: 'hsl(210 40% 98%)',
            },
            border: 'hsl(214.3 31.8% 91.4%)',
            input: 'hsl(214.3 31.8% 91.4%)',
            ring: 'hsl(222.2 84% 4.9%)',
            zoey: '#00FFAE',
          },
          borderRadius: {
            lg: '0.5rem',
            md: 'calc(0.5rem - 2px)',
            sm: 'calc(0.5rem - 4px)',
          }
        }
      }
    }
  </script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
    .log-info { color: #3b82f6; }
    .log-warn { color: #f59e0b; }
    .log-error { color: #ef4444; }
    .log-debug { color: #6b7280; }
    /* shadcn 风格的输入框聚焦 */
    input:focus, select:focus {
      outline: none;
      border-color: #00FFAE;
      box-shadow: 0 0 0 2px rgba(0, 255, 174, 0.2);
    }
    /* 滚动条 */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
    /* 动画 */
    @keyframes slide-up {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-slide-up { animation: slide-up 0.2s ease-out; }
  </style>
</head>
<body class="bg-background text-foreground min-h-screen">
  <div id="app" class="flex flex-col h-screen">
    
    <!-- Header -->
    <header class="border-b px-4 py-3 bg-card">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <!-- ZOEY Logo -->
          <div class="w-8 h-8 rounded-md flex items-center justify-center" style="background-color: #00FFAE;">
            <svg width="20" height="20" viewBox="0 0 1864 1864" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M231.385 758.89V308H1691C1666.84 346.916 1636.87 393.79 1602.42 448.903C1559.75 517.159 1493.7 624.026 1493.7 624.026C1493.7 624.026 1415.85 746.813 1376.93 807.2C1339.35 867.587 1304.45 923.277 1272.24 974.271C1240.03 1023.92 1214.53 1064.85 1195.74 1097.06C1195.74 1098.4 1195.07 1099.74 1193.72 1101.08C1195.07 1101.08 1195.74 1101.08 1195.74 1101.08H1658.79V1556H173L702.488 762.916C702.488 761.574 702.488 760.903 702.488 760.903C703.83 759.561 704.501 758.89 704.501 758.89C704.501 758.89 703.83 758.89 702.488 758.89H231.385Z" fill="#FFCC00"/>
            </svg>
          </div>
          <div>
            <h1 class="text-base font-semibold">Zoey Worker</h1>
            <p class="text-xs text-muted-foreground">UI 自动化执行客户端</p>
          </div>
        </div>
        <div id="statusIndicator" class="flex items-center gap-2 text-sm text-muted-foreground">
          <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
          未连接
        </div>
      </div>
      <!-- 连接信息（连接后显示） -->
      <div id="headerConnectionInfo" class="hidden mt-3 pt-3 border-t border-dashed">
        <div class="flex items-center gap-4 text-xs">
          <div class="flex items-center gap-1.5">
            <span class="text-muted-foreground">Agent:</span>
            <span id="headerAgentName" class="font-medium text-foreground">-</span>
          </div>
          <div class="flex items-center gap-1.5">
            <span class="text-muted-foreground">ID:</span>
            <code id="headerAgentId" class="font-mono text-muted-foreground bg-muted px-1.5 py-0.5 rounded">-</code>
            <button id="copyAgentIdBtn" class="p-1 hover:bg-muted rounded transition-colors" title="复制 Agent ID">
              <i data-lucide="copy" class="w-3 h-3 text-muted-foreground"></i>
            </button>
          </div>
        </div>
      </div>
    </header>
    
    <!-- Tab Navigation -->
    <nav class="border-b px-4 bg-card">
      <div class="flex gap-1">
        <button data-tab="connection" class="tab-btn px-4 py-2.5 text-sm font-medium border-b-2 border-primary text-foreground">
          <i data-lucide="plug" class="w-4 h-4 inline mr-1.5"></i>连接
        </button>
        <button data-tab="settings" class="tab-btn px-4 py-2.5 text-sm font-medium border-b-2 border-transparent text-muted-foreground hover:text-foreground">
          <i data-lucide="settings" class="w-4 h-4 inline mr-1.5"></i>设置
        </button>
        <button data-tab="logs" class="tab-btn px-4 py-2.5 text-sm font-medium border-b-2 border-transparent text-muted-foreground hover:text-foreground">
          <i data-lucide="scroll-text" class="w-4 h-4 inline mr-1.5"></i>日志
        </button>
      </div>
    </nav>
    
    <!-- Main Content -->
    <main class="flex-1 overflow-auto p-4 bg-muted/30">
      
      <!-- Connection Tab - 居中显示，不需要滚动 -->
      <div id="tab-connection" class="tab-content h-full flex items-center justify-center">
        <div class="bg-card rounded-lg border shadow-sm p-5 w-full max-w-xs">
          <form id="connectForm" class="space-y-3">
            <div>
              <label class="block text-xs font-medium mb-1 text-muted-foreground">服务器地址</label>
              <input type="text" id="serverUrl" value="localhost:50051" placeholder="localhost:50051"
                class="w-full px-3 py-2 bg-background border rounded-md text-sm placeholder:text-muted-foreground transition-colors">
            </div>
            
            <div>
              <label class="block text-xs font-medium mb-1 text-muted-foreground">Access Key</label>
              <input type="text" id="accessKey" placeholder="输入 Access Key"
                class="w-full px-3 py-2 bg-background border rounded-md text-sm placeholder:text-muted-foreground transition-colors">
            </div>
            
            <div>
              <label class="block text-xs font-medium mb-1 text-muted-foreground">Secret Key</label>
              <input type="password" id="secretKey" placeholder="输入 Secret Key"
                class="w-full px-3 py-2 bg-background border rounded-md text-sm placeholder:text-muted-foreground transition-colors">
            </div>
            
            <div id="errorMessage" class="hidden bg-destructive/10 border border-destructive/20 text-destructive px-3 py-2 rounded-md text-xs"></div>
            
            <div class="flex gap-2 pt-1">
              <button type="submit" id="connectBtn"
                class="flex-1 bg-primary hover:bg-primary/90 disabled:opacity-50 text-primary-foreground font-medium py-2 px-4 rounded-md transition-colors text-sm">
                连接
              </button>
              <button type="button" id="disconnectBtn"
                class="hidden flex-1 bg-destructive hover:bg-destructive/90 text-destructive-foreground font-medium py-2 px-4 rounded-md transition-colors text-sm">
                断开
              </button>
            </div>
          </form>
        </div>
        <!-- 隐藏的连接信息元素，供 JS 兼容 -->
        <div id="connectionInfo" class="hidden">
          <span id="agentIdDisplay"></span>
          <span id="agentNameDisplay"></span>
        </div>
      </div>
      
      <!-- Settings Tab -->
      <div id="tab-settings" class="tab-content hidden max-w-md mx-auto">
        <div class="space-y-4">
          
          <!-- 系统权限（仅 macOS） -->
          <div id="permissionsSection" class="bg-card rounded-lg border shadow-sm p-6">
            <h2 class="text-base font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="shield" class="w-5 h-5 text-muted-foreground"></i>
              系统权限
            </h2>
            <div class="space-y-4">
              <!-- 辅助功能权限 -->
              <div class="flex items-center justify-between">
                <div>
                  <span class="text-sm font-medium">辅助功能</span>
                  <p class="text-xs text-muted-foreground">用于获取窗口标题和控制应用</p>
                </div>
                <div id="accessibilityStatus" class="flex items-center gap-2">
                  <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
                  <span class="text-sm text-muted-foreground">检查中...</span>
                </div>
              </div>
              <button id="openAccessibilityBtn" class="hidden w-full bg-amber-500 hover:bg-amber-600 text-white text-sm font-medium py-2 px-4 rounded-md transition-colors">
                <i data-lucide="external-link" class="w-4 h-4 inline mr-2"></i>
                打开辅助功能设置
              </button>
              
              <!-- 屏幕录制权限 -->
              <div class="flex items-center justify-between">
                <div>
                  <span class="text-sm font-medium">屏幕录制</span>
                  <p class="text-xs text-muted-foreground">用于截图和图像识别</p>
                </div>
                <div id="screenRecordingStatus" class="flex items-center gap-2">
                  <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
                  <span class="text-sm text-muted-foreground">检查中...</span>
                </div>
              </div>
              <button id="openScreenRecordingBtn" class="hidden w-full bg-amber-500 hover:bg-amber-600 text-white text-sm font-medium py-2 px-4 rounded-md transition-colors">
                <i data-lucide="external-link" class="w-4 h-4 inline mr-2"></i>
                打开屏幕录制设置
              </button>
              
              <!-- 权限提示 -->
              <div id="permissionWarning" class="hidden mt-3 bg-amber-50 border border-amber-200 text-amber-800 px-4 py-3 rounded-md text-sm">
                <i data-lucide="alert-triangle" class="w-4 h-4 inline mr-2"></i>
                缺少必要权限，部分功能可能无法正常工作。授权后请重启应用。
              </div>
            </div>
          </div>
          
          <!-- 连接设置 -->
          <div class="bg-card rounded-lg border shadow-sm p-6">
            <h2 class="text-base font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="wifi" class="w-5 h-5 text-muted-foreground"></i>
              连接设置
            </h2>
            <div class="space-y-4">
              <label class="flex items-center justify-between cursor-pointer">
                <div>
                  <span class="text-sm font-medium">启动时自动连接</span>
                  <p class="text-xs text-muted-foreground">应用启动后自动连接到服务器</p>
                </div>
                <input type="checkbox" id="settingAutoConnect" class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary cursor-pointer">
              </label>
              <label class="flex items-center justify-between cursor-pointer">
                <div>
                  <span class="text-sm font-medium">断开后自动重连</span>
                  <p class="text-xs text-muted-foreground">连接断开后自动尝试重新连接</p>
                </div>
                <input type="checkbox" id="settingAutoReconnect" class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary cursor-pointer">
              </label>
              <div class="flex items-center justify-between">
                <div>
                  <span class="text-sm font-medium">重连间隔</span>
                  <p class="text-xs text-muted-foreground">自动重连的时间间隔</p>
                </div>
                <select id="settingReconnectInterval" class="px-3 py-1.5 bg-background border rounded-md text-sm">
                  <option value="3">3 秒</option>
                  <option value="5">5 秒</option>
                  <option value="10">10 秒</option>
                  <option value="30">30 秒</option>
                  <option value="60">60 秒</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- 日志设置 -->
          <div class="bg-card rounded-lg border shadow-sm p-6">
            <h2 class="text-base font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="file-text" class="w-5 h-5 text-muted-foreground"></i>
              日志设置
            </h2>
            <div class="flex items-center justify-between">
              <div>
                <span class="text-sm font-medium">日志级别</span>
                <p class="text-xs text-muted-foreground">显示的最低日志级别</p>
              </div>
              <select id="settingLogLevel" class="px-3 py-1.5 bg-background border rounded-md text-sm">
                <option value="DEBUG">DEBUG</option>
                <option value="INFO">INFO</option>
                <option value="WARN">WARN</option>
                <option value="ERROR">ERROR</option>
              </select>
            </div>
          </div>
          
          <!-- 界面设置 -->
          <div class="bg-card rounded-lg border shadow-sm p-6">
            <h2 class="text-base font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="monitor" class="w-5 h-5 text-muted-foreground"></i>
              界面设置
            </h2>
            <div class="space-y-4">
              <label class="flex items-center justify-between cursor-pointer">
                <div>
                  <span class="text-sm font-medium">关闭时最小化到托盘</span>
                  <p class="text-xs text-muted-foreground">点击关闭按钮时隐藏到系统托盘</p>
                </div>
                <input type="checkbox" id="settingMinimizeToTray" class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary cursor-pointer">
              </label>
              <label class="flex items-center justify-between cursor-pointer">
                <div>
                  <span class="text-sm font-medium">启动时最小化</span>
                  <p class="text-xs text-muted-foreground">应用启动后自动隐藏窗口</p>
                </div>
                <input type="checkbox" id="settingStartMinimized" class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary cursor-pointer">
              </label>
            </div>
          </div>
          
          <!-- 保存提示 -->
          <div id="settingsSaved" class="hidden bg-emerald-50 border border-emerald-200 text-emerald-700 px-4 py-3 rounded-md text-sm text-center">
            <i data-lucide="check-circle" class="w-4 h-4 inline mr-1"></i>
            设置已保存
          </div>
          
        </div>
      </div>
      
      <!-- Logs Tab -->
      <div id="tab-logs" class="tab-content hidden">
        <div class="bg-card rounded-lg border shadow-sm">
          <div class="px-4 py-3 border-b flex items-center justify-between">
            <h2 class="text-sm font-semibold flex items-center gap-2">
              <i data-lucide="scroll-text" class="w-4 h-4 text-muted-foreground"></i>
              运行日志
            </h2>
            <button id="refreshLogsBtn" class="text-sm text-muted-foreground hover:text-foreground transition-colors flex items-center gap-1">
              <i data-lucide="refresh-cw" class="w-4 h-4"></i>
              刷新
            </button>
          </div>
          <div id="logContainer" class="p-2 h-96 overflow-auto font-mono text-xs bg-muted/30">
            <div id="emptyLogs" class="p-8 text-center text-muted-foreground">暂无日志</div>
            <div id="logList"></div>
          </div>
        </div>
      </div>
      
    </main>
    
    <!-- Footer -->
    <footer class="border-t px-4 py-2 flex items-center justify-between text-xs text-muted-foreground bg-card">
      <span id="systemInfo">-</span>
      <span id="currentTime"></span>
    </footer>
    
  </div>
  
  <script src="app.js"></script>
</body>
</html>
